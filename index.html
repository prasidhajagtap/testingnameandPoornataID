<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Game | Handshake Receiver</title>
    <style>
        :root { --dash-blue: #0056b3; --seamex-orange: #ff6600; --bg: #f4f7f9; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; border-radius: 16px; padding: 24px; width: 100%; max-width: 400px; box-shadow: 0 8px 30px rgba(0,0,0,0.08); border-top: 8px solid var(--dash-blue); text-align: center;}
        .powered-by { font-size: 10px; color: #999; text-transform: uppercase; letter-spacing: 2px; margin: 5px 0 20px 0; }
        .data-box { background: #f8f9fa; border: 1px solid #eaeaea; padding: 15px; border-radius: 12px; margin-bottom: 10px; text-align: left; }
        .label { font-size: 11px; color: var(--dash-blue); font-weight: 800; text-transform: uppercase; }
        .value { font-size: 18px; color: #333; font-family: monospace; margin-top: 5px; min-height: 22px; }
        .status { font-size: 12px; margin-top: 10px; padding: 5px; border-radius: 4px; font-weight: bold; }
        .waiting { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .btn-launch { background: var(--dash-blue); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 15px; cursor: pointer; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin:0;">Identity Link</h2>
    <div class="powered-by">Powered By Seamex</div>

    <div id="status-msg" class="status waiting">Verifying ADFS Session...</div>

    <div class="data-box">
        <div class="label">Employee ID</div>
        <div id="display-id" class="value">---</div>
    </div>

    <div class="data-box">
        <div class="label">Employee Name</div>
        <div id="display-name" class="value">---</div>
    </div>

    <button id="launch-btn" class="btn-launch" onclick="launchGame()">START DASH GAME</button>
</div>

<script>
    function processHandshake() {
        const urlParams = new URLSearchParams(window.location.search);
        
        // These are the parameters typically passed after an ADFS PeopleSoft redirect
        let empId = urlParams.get('hdnpoornataid') || urlParams.get('id');
        let empName = urlParams.get('hdnName') || urlParams.get('name');

        if (empId && empName && !empId.includes('[')) {
            // Success Case: We have real data
            document.getElementById('display-id').innerText = empId;
            document.getElementById('display-name').innerText = decodeURIComponent(empName).replace(/_/g, ' ');
            
            document.getElementById('status-msg').innerText = "Handshake Successful";
            document.getElementById('status-msg').className = "status success";
            document.getElementById('launch-btn').style.display = "block";
            
            // Save for your Game's High Score Logic
            localStorage.setItem('game_user_id', empId);
            localStorage.setItem('game_user_name', empName);
        } else {
            // Failure Case: No data found in URL
            document.getElementById('status-msg').innerText = "Waiting for Portal Handshake...";
            console.log("Session active but parameters missing in redirect.");
        }
    }

    function launchGame() {
        // This would lead to your main game file
        alert("Launching Dash Game as: " + localStorage.getItem('game_user_name'));
        // window.location.href = "game.html"; 
    }

    window.onload = processHandshake;
</script>

</body>
</html>
